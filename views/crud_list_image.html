<!-- vusers.html -->
{{$session := .Session}}
{{$appid := .AppId}}
{{$portail := .Portail}}
{{$app := .Application}}
{{$theme := .Config.Theme}}
{{$tableid := .TableId}}
{{$viewid := .ViewId}}
{{$formaddid := .FormAddId}}
{{$table := .Table}}
{{$tablekey := .Table.Key}}
{{$view := .View}}
{{$elements := .Elements}}
{{$cols := .Cols}}
{{$composter := .Composter}}
{{$qrecords := .Qrecords}}
<!DOCTYPE html>
<html>
{{template "_crud_head.html" .}}

<body>
  <!-- NAVBAR -->
  <div class="ui container">
    <div class="ui {{.Config.Theme}} inverted large fixed menu navbar">
      <!-- LEFT MENU -->
      <div class="ui dropdown item">
        <div class="ui mini image">
          <img src="{{$app.Image}}">
        </div>
        <div class="menu">
          <a href="/crud" class="item"><i class="home icon"></i> Page d'accueil</a>
          {{if $app.AppViews}}
          <div class="divider"></div>
          {{end}}
          {{ range $iv, $appView := $app.AppViews }}
          {{$t := index $portail.Tables $appView.Tableid }}
          {{$v := index $t.Views $appView.Viewid }}
          <a class="item{{if and (eq $appView.Tableid $tableid) (eq $appView.Viewid $viewid)}} {{$theme}} active{{end}}"
            href="/crud/list/{{$appid}}/{{$appView.Tableid}}/{{$appView.Viewid}}">
            <i class="{{$v.IconName}} icon"></i>
            {{$v.Title}}
          </a>
          {{end}}
          <!-- end range appViewq-->
          <div class="divider"></div>
          <div class="header">
            <i class="user icon"></i>
            {{.Session.Username}}
          </div>
          <a class="item" href="/crud/edit/users/users/vall/fprofil/{{.Session.Username}}">Mon profil</a>
          <a class="item" href="/crud/logout">Se déconnecter</a>
          <a href="/crud/about" class="item">À propos</a>
        </div>
      </div>
      <div class="header item" id="crud-header">
        {{$view.Title}}
        {{if (eq $qrecords 0)}}
        (auncun élément)
        {{else if (eq $qrecords 1)}}
        (1 élément)
        {{else}}
        ({{$qrecords}} éléments)
        {{end}}
      </div>
      <!-- RIGHT MENU -->
      <div class="right menu">
        <div class="ui icon item">
          <i class="search link icon" id="crud-search-active" title="Rechercher..."></i>
          <!-- Recherche -->
          <div style="display: none" id="crud-search">
            <div class="ui icon input">
              <input type="text" id="crud-search-input" placeholder="Recherche...">
              <i class="search icon"></i>
            </div>
            <i class="close link icon" id="crud-search-close" title="Fin recherche"></i>
          </div>
        </div>
        {{if or $view.Actions $view.FormAdd}}
        <div class="ui dropdown item">
          <i class="ellipsis vertical icon"></i>
          <div class="menu">
            {{if $view.FormAdd}}
            <a class="ui icon item crud-jquery-url"
              data-url="/crud/add/{{$appid}}/{{$tableid}}/{{$viewid}}/{{$formaddid}}">
              <i class="plus square icon"></i> Ajouter un élément...
            </a>
            {{end}}
            {{if $view.Actions}}
            {{if $view.FormAdd}}
            <div class="divider"></div>
            {{end}}
            {{range $iaction, $action := $view.Actions}}
            <a class="item crud-jquery-action" data-confirm="{{$action.WithConfirm}}"
              data-url="/crud/actionv/{{$appid}}/{{$tableid}}/{{$viewid}}/{{$iaction}}">{{str2html $action.Label}}</a>
            {{end}}
            <!-- end range actions-->
            {{end}}
            <!-- end if actions-->
          </div>
        </div>
        {{end}}
        <!-- end dropdown MENU à droite -->
      </div>
      <!-- end right menu -->
    </div>
  </div>
  <!-- MAIN -->
  <main>
    <div class="ui container">
      {{template "_crud_flash.html" .}}
      <!-- ITEMS -->
      <div class="ui cards crud-searchable">
        {{ range $irecord, $record := .Records }}
        {{ range $num, $key := $cols }}
        {{ $val := CrudIndex $record $key }}
        {{ $element := index $elements $key }}
        <!-- On ne prend que les element image-->
        {{if (eq $element.Type "image")}}
        {{$url := CrudMacro $element.Params.URL $record $session}}
        {{$path := CrudMacro $element.Params.Path $record $session}}
        <div id="{{CrudIndexAnchor $record $tablekey}}"
        {{if or $view.FormView $view.FormView}}
            class="card raised crud-card-view crud-card-searchable crud-jquery-url"
            data-url="/crud/view/{{$appid}}/{{$tableid}}/{{$viewid}}/{{index $record $tablekey}}" {{else}}
            class="card raised crud-card-view crud-card-searchable" {{end}}
          >
          <div class="ui image">
            <img src="{{$path}}?{{$composter}}" class="crud-popup-image" data-url="{{$path}}?{{$composter}}">
          </div>
          <div class="content">
            <div class="center aligned description">
              {{$element.LabelLong}}
            </div>

            {{if $element.Params.Header}}
            <div class="header">
              {{range $im, $key := $element.Params.Header}}
              {{ $ele := index $elements $key }}
              {{ $class := CrudMacroSQL $ele.ClassSQL $record $session}}
              {{ $val := CrudIndex $record $key}}
              {{if (eq $ele.Type "combo")}}
              <span class="ui {{$class}} text searchable">{{CrudItem $ele.Items $val}} ({{$val}})</span>
              {{else}}
              <span class="ui {{$class}} text searchable">{{CrudFormat $ele.Format $val}}</span>
              {{end}}
              {{end}}

            </div><!-- end Header -->
            {{end}}

            {{if $element.Params.Meta}}
            <div class="right floated meta">
              {{range $im, $key := $element.Params.Meta}}
              {{ $ele := index $elements $key }}
              {{ $class := CrudMacroSQL $ele.ClassSQL $record $session}}
              {{ $val := CrudIndex $record $key}}
              {{if (eq $ele.Type "checkbox")}}
              {{if (eq $val "1") }}
              <div class="ui label">
                <i class="check square outline icon"></i>
                <span class="searchable">{{$ele.LabelLong}}</span>
              </div>
              {{else}}
              <div class="ui label">
                <i class="square outline icon"></i>
                <span>{{$ele.LabelLong}}</span>
              </div>
              {{end}}
              {{else if (eq $ele.Type "combo")}}
              <span class="ui {{$class}} text searchable">{{CrudItem $ele.Items $val}} ({{$val}})</span>
              {{else if (eq $ele.Type "tag")}}
              {{$arr := CrudSplit $val ","}}
              {{range $i, $item := $arr}}
              <div class="ui tag label"><b>{{$item}}</b></div>
              {{end}}
              {{else if (eq $ele.Type "hidden")}}
              <input type="hidden" name="{{$key}}">
              {{else}}
              <!-- autre type -->
              {{if $ele.LabelShort}}<span class="ui grey text">{{$ele.LabelShort}} : </span>{{end}}
              <span class="ui {{$class}} text searchable"><b>{{CrudFormat $ele.Format $val}}</b></span>
              {{end}}
              {{end}}
            </div><!-- end Meta -->
            {{end}}

            {{if $element.Params.Description}}
            <div class="description">
              {{range $im, $key := $element.Params.Description}}
              {{ $ele := index $elements $key }}
              {{ $class := CrudMacroSQL $ele.ClassSQL $record $session}}
              {{ $val := CrudIndex $record $key}}
              <span class="ui {{$class}} text searchable"><b>{{CrudFormat $ele.Format $val}}</b></span>
              {{end}}
            </div><!-- end Description -->
            {{end}}

            {{if $element.Params.Extra}}
            <div class="right floated extra">
              {{range $im, $key := $element.Params.Extra}}
              {{ $ele := index $elements $key }}
              {{ $class := CrudMacroSQL $ele.ClassSQL $record $session}}
              {{ $val := CrudIndex $record $key}}
              {{if (eq $ele.Type "checkbox")}}
              {{if (eq $val "1") }}
              <div class="ui label">
                <i class="check square outline icon"></i>
                <span class="searchable">{{$ele.LabelLong}}</span>
              </div>
              {{else}}
              <div class="ui label">
                <i class="square outline icon"></i>
                <span>{{$ele.LabelLong}}</span>
              </div>
              {{end}}
              {{else if (eq $ele.Type "combo")}}
              <span class="ui {{$class}} text searchable">{{CrudItem $ele.Items $val}} ({{$val}})</span>
              {{else if (eq $ele.Type "tag")}}
              {{$arr := CrudSplit $val ","}}
              {{range $i, $item := $arr}}
              <div class="ui tag label"><b>{{$item}}</b></div>
              {{end}}
              {{else if (eq $ele.Type "hidden")}}
              <input type="hidden" name="{{$key}}">
              {{else}}
              <!-- autre type -->
              {{if $ele.LabelShort}}<span class="ui grey text">{{$ele.LabelShort}} : </span>{{end}}
              <span class="ui {{$class}} text searchable"><b>{{CrudFormat $ele.Format $val}}</b></span>
              {{end}}
              {{end}}
            </div><!-- end Extra -->
            {{end}}

          </div><!-- end content-->
        </div>
        {{end}}
        <!-- end if image -->
        {{end}}
        <!-- end range records-->
        {{end}}
        <!-- end range $records -->
      </div>
    </div> <!-- end container-->
  </main>
  <!-- Demande de confirmation de l'action' -->
  <div id="crud-modal-confirm" class="ui modal">
    <div class="header" id="crud-action">Texte à venir</div>
    <div class="content">
      <p>Veuillez le confirmer</p>
    </div>
    <div class="actions">
      <div class="ui cancel button">Annuler</div>
      <div class="ui approve button">Je confirme</div>
    </div>
  </div> <!-- end modal confirm -->
  <!-- Affichage d'une image en popup-->
  <div id="crud-modal-image" class="ui fullscreen modal">
    <div class="actions">
      <div class="ui cancel button">Fermer</div>
    </div>
    <div class="image content">
      <img id="crud-image" class="image center aligned" src="">
    </div>
  </div> <!-- end modal image -->
  <form action="" method="POST">
    {{ .xsrfdata }}
  </form>
  <!-- CONTEXTE -->
  <input type="hidden" id="crud_view" value="{{$appid}}-{{$tableid}}-{{$viewid}}">

  {{template "_crud_foot.html" .}}
</body>

</html>