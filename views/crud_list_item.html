<!-- vusers.html -->
{{$session := .Session}}
{{$appid := .AppId}}
{{$portail := .Portail}}
{{$app := .Application}}
{{$theme := .Config.Theme}}
{{$tableid := .TableId}}
{{$viewid := .ViewId}}
{{$formaddid := .FormAddId}}
{{$table := .Table}}
{{$tablekey := .Table.Key}}
{{$view := .View}}
{{$elements := .Elements}}
{{$cols := .Cols}}
<!DOCTYPE html>
<html>
{{template "_crud_head.html" .}}

<body>
  <!-- NAVBAR -->
  <div class="ui container">
    <div class="ui {{.Config.Theme}} inverted large fixed menu navbar">
      <div class="item">
        <a class="ui mini image" href="/crud">
          <img src="{{$app.Image}}">
        </a>
      </div>
      <div class="header item">{{$app.Title}}</div>
      <div class="right menu">
        <div class="ui icon item">
          <i class="search link icon" id="crud-search-active" title="Rechercher..."></i>
        </div>
        <a class="ui icon item crud-jquery-url" data-url="/crud/add/{{$appid}}/{{$tableid}}/{{$viewid}}/{{$formaddid}}"
          title="Ajouter un article...">
          <i class="plus square icon"></i>
        </a>
        {{if $view.Actions}}
        <div class="ui dropdown item">
          <i class="ellipsis vertical icon"></i>
          <div class="menu">
            {{range $iaction, $action := $view.Actions}}
            <a class="item crud-jquery-action" data-confirm="{{$action.WithConfirm}}"
              data-url="/crud/actionv/{{$appid}}/{{$tableid}}/{{$viewid}}/{{$iaction}}">{{str2html $action.Label}}</a>
            {{end}}
          </div>
        </div>
        {{end}}
        <!-- end ActionSQL -->
      </div>
    </div>
  </div>
  </div>
  <!-- MAIN -->
  <main>
    <div class="ui container">
      {{template "_crud_flash.html" .}}
      {{$lenAppViews := len $app.AppViews }}
      {{if (gt $lenAppViews 1)}}
      <div class="ui pointing compact menu">
        {{ range $iv, $appView := $app.AppViews }}
        {{$t := index $portail.Tables $appView.Tableid }}
        {{$v := index $t.Views $appView.Viewid }}
        <a class="item{{if and (eq $appView.Tableid $tableid) (eq $appView.Viewid $viewid)}} active{{end}}"
          href="/crud/list/{{$appid}}/{{$appView.Tableid}}/{{$appView.Viewid}}">
          <i class="{{$v.IconName}} icon"></i>
          {{$v.Title}}
        </a>
        {{end}}
        <!-- end range appViewq-->
        <!-- Recherche -->
        <div class="ui search item" style="display: none" id="crud-search">
          <div class="ui transparent icon input">
            <input type="text" id="crud-search-input" placeholder="Recherche...">
            <i class="search icon"></i>
          </div>
        </div>
      </div>
      {{else}}
      <!-- Recherche -->
      <div style="display: none" id="crud-search">
        <div class="ui icon input">
          <input type="text" id="crud-search-input" placeholder="Recherche...">
          <i class="search icon"></i>
        </div>
      </div>
      {{end}}
      <!-- end if menu -->
      <!-- ITEMS -->
      <div class="ui relaxed divided items">
        {{ range $irecord, $record := .Records }}
        <a class="crud-jquery-url {{CrudMacroSQL $view.ClassSQL $record $session}} item"
          data-url="/crud/view/{{$appid}}/{{$tableid}}/{{$viewid}}/{{index $record $tablekey}}">
          <i class="large {{$theme}} {{$view.IconName}} middle aligned icon"></i>
          {{ range $num, $key := $cols }}
          {{ $element := index $elements $key }}
          {{ $val := CrudIndexSQL $record $key $element $session}}
          {{if (ne $element.Hide true)}}
          {{if (eq $element.Type "combo")}}
          <div class="content">
            <div class="description">
              <div class="meta">
                <span>{{$element.LabelLong}}</span>
              </div>
            </div>
            <div class="header">
              <h4>{{CrudItem $element.Items $val}} ({{$val}})</h4>
            </div>
          </div>
          {{else if (eq $element.Type "checkbox")}}
          <div class="content">
            <div class="description">&nbsp;</div>
            <div class="header">
              <h4>
                {{if (eq $val "1") }}
                <i class="check square outline icon"></i> {{$element.LabelLong}}
                {{else}}
                <i class="square outline icon"></i> {{$element.LabelLong}}
                {{end}}
              </h4>
            </div>
          </div>
          {{else if (eq $element.Type "tag")}}
          <div class="content">
            <div class="description">
              <div class="meta">
                <span>{{$element.LabelLong}}</span>
              </div>
            </div>
            {{$arr := CrudSplit $val ","}}
            {{range $i, $item := $arr}}
            <div class="ui small label">{{$item}}</div>
            {{end}}
            {{else if (eq $element.Type "textarea")}}
            <div class="description">
              <div class="meta">
                <span>{{$element.LabelLong}}</span>
              </div>
            </div>
            <div class="ui {{$element.Class}} message">
              {{$val}}
            </div>
          </div>
          {{else}}
          <!-- autre types -->
          <div class="content">
            <div class="description">
              <div class="meta">
                <span>{{$element.LabelLong}}</span>
              </div>
            </div>
            <div class="header">
              <span class="ui medium {{$element.Class}} text">
                {{if $element.Format}}
                {{CrudFormat $element.Format $val}}
                {{else}}
                {{$val}}
                {{end}}
              </span>
            </div>
          </div>
          {{end}}
          <!-- end type -->
          {{end}}
          <!-- end if Hide -->
          {{end}}
          <!-- end range $cols -->
        </a> <!-- end item -->
        {{end}}
        <!-- end range $records -->
      </div><!-- end items -->
    </div> <!-- end container-->
  </main>
  <!-- Demande de confirmation de l'action' -->
  <div class="ui modal">
    <div class="header" id="crud-action">Texte Ã  venir</div>
    <div class="content">
      <p>Veuillez le confirmer</p>
    </div>
    <div class="actions">
      <div class="ui cancel button">Annuler</div>
      <div class="ui approve button">Je confirme</div>
    </div>
  </div> <!-- Action-->
  <form action="" method="POST">
    {{ .xsrfdata }}
  </form>

  {{template "_crud_foot.html" .}}
</body>

</html>